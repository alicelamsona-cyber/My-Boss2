<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>CEO Financial Master - 極致黑金</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@100;300;400;700;900&display=swap" rel="stylesheet">
    <style>
        :root { --gold: #d4af37; --gold-light: #f9d423; --gold-dark: #aa8b2e; }
        * { -webkit-tap-highlight-color: transparent; touch-action: manipulation; box-sizing: border-box; outline: none; }
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #000;
            color: #e5e5e5;
            height: 100vh;
            height: 100dvh;
            margin: 0;
            overflow: hidden;
            position: fixed;
            width: 100%;
        }
        .gold-gradient { background: linear-gradient(135deg, var(--gold) 0%, var(--gold-light) 50%, var(--gold-dark) 100%); }
        .gold-text {
            background: linear-gradient(135deg, var(--gold) 0%, var(--gold-light) 50%, var(--gold-dark) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .gold-border { border: 1px solid rgba(212, 175, 55, 0.3); }
        .gold-border-focus:focus { border-color: var(--gold); box-shadow: 0 0 10px rgba(212, 175, 55, 0.2); }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .safe-bottom { padding-bottom: env(safe-area-inset-bottom); }
        .safe-top { padding-top: env(safe-area-inset-top); }
        @keyframes slideUp { from { transform: translateY(10px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .animate-slideUp { animation: slideUp 0.3s ease-out forwards; }
        .modal-blur { backdrop-filter: blur(20px); background-color: rgba(0,0,0,0.85); -webkit-backdrop-filter: blur(20px); }
        input[type="date"]::-webkit-calendar-picker-indicator { filter: invert(1); }
        .view-container { display: flex; flex-direction: column; height: 100%; width: 100%; overflow: hidden; }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="module">
        import React, { useState, useEffect, useMemo, useCallback } from 'https://esm.sh/react@19';
        import ReactDOM from 'https://esm.sh/react-dom@19/client';
        import htm from 'https://esm.sh/htm';

        const html = htm.bind(React.createElement);

        // --- Constants ---
        const AssetType = {
            CASH: '現金',
            STOCKS: '股票',
            US_BONDS: '美債',
            GOLD: '黃金',
            SAVINGS: '定期',
            OTHERS: '其他'
        };

        const CATEGORIES = ['餐飲', '交通', '娛樂', '購物', '居住', '醫療', '教育', '其他'];

        const CEO_QUOTES = [
            "這點錢也想退休？我看你是想在大街上退休。",
            "我的字典裡沒有『窮』這個字，希望你的帳本裡也沒有。",
            "這筆開銷... 你是覺得我給你的卡刷不爆嗎？",
            "認真點，你的資產增長速度還不如我喝咖啡的速度。",
            "如果你連自己的錢都管不好，你拿什麼管我的心？",
            "跟我在一起，你的野心應該比你的餘額更大。",
            "這張報表，我不滿意。明天我要看到成長。",
            "錢不是省出來的，是賺出來的。但如果你連省都不會，你拿什麼去賺？",
            "省下那杯拿鐵，你也不會變富有；但我喜歡你為了目標克制的樣子。",
            "在我面前，你不需要談論『困難』，只需要談論『結果』。"
        ];

        const fmt = (v) => new Intl.NumberFormat('zh-HK', { style: 'currency', currency: 'HKD', maximumFractionDigits: 0 }).format(v);

        // --- View Components ---

        const Home = ({ quote, totalAssets, totalMonthlyExpenses, goal, userName, goldPrice, isGoldLoading, onRefreshGold }) => {
            const percentage = Math.min(Math.round((totalAssets / goal) * 100), 100);
            return html`
                <div className="view-container animate-slideUp py-2">
                    <div className="flex-1 overflow-y-auto no-scrollbar space-y-6">
                        <div className="relative p-5 gold-border bg-zinc-900/60 rounded-2xl mx-1">
                            <div className="absolute -top-2.5 left-5 bg-black px-2 gold-text font-black text-[9px] tracking-widest uppercase">${userName} 的訓示</div>
                            <p className="text-lg font-light italic text-white leading-relaxed">「${quote}」</p>
                        </div>

                        <div className="flex flex-col items-center">
                            <div className="relative w-44 h-44 flex items-center justify-center">
                                <svg className="absolute w-full h-full -rotate-90" viewBox="0 0 200 200">
                                    <circle cx="100" cy="100" r="88" stroke="rgba(212, 175, 55, 0.05)" strokeWidth="10" fill="transparent" />
                                    <circle cx="100" cy="100" r="88" stroke="#d4af37" strokeWidth="10" fill="transparent" strokeDasharray="552.9" strokeDashoffset=${552.9 - (552.9 * percentage) / 100} strokeLinecap="round" className="transition-all duration-1000" />
                                </svg>
                                <div className="text-center z-10">
                                    <span className="text-5xl font-black gold-text">${percentage}%</span>
                                    <p className="text-zinc-500 text-[9px] mt-1 uppercase tracking-widest font-bold text-center">目標達成</p>
                                </div>
                            </div>
                            <div className="text-center mt-6">
                                <p className="text-4xl font-extralight text-white tracking-tighter">${fmt(totalAssets)}</p>
                                <p className="text-zinc-500 text-[10px] uppercase font-black tracking-[0.2em] mt-2">年度目標：${fmt(goal)}</p>
                            </div>
                        </div>

                        <div className="grid grid-cols-2 gap-3 mx-1">
                            <div className="p-4 bg-zinc-900/40 rounded-2xl border border-zinc-800/50">
                                <p className="text-zinc-500 text-[9px] uppercase font-bold tracking-widest mb-1">本月支出</p>
                                <p className="text-lg font-bold text-white">${fmt(totalMonthlyExpenses)}</p>
                            </div>
                            <div className="p-4 bg-zinc-900/40 rounded-2xl border border-zinc-800/50 relative overflow-hidden" onClick=${onRefreshGold}>
                                <div className="flex justify-between items-start mb-1">
                                    <p className="text-zinc-500 text-[9px] uppercase font-bold tracking-widest">實時金價</p>
                                    <div className=${`w-1.5 h-1.5 rounded-full ${isGoldLoading ? 'bg-zinc-500 animate-pulse' : 'bg-green-500 shadow-sm'}`}></div>
                                </div>
                                <p className="text-lg font-bold gold-text">$${goldPrice.toFixed(1)}/g</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        };

        const AssetsView = ({ assets, onAdd, onUpdate, onDelete, goldPrice }) => {
            const [showAdd, setShowAdd] = useState(false);
            const [editAsset, setEditAsset] = useState(null);
            const [name, setName] = useState('');
            const [val, setVal] = useState('');
            const [weight, setWeight] = useState('');
            const [type, setType] = useState(AssetType.CASH);

            const resetForm = () => { setName(''); setVal(''); setWeight(''); setType(AssetType.CASH); setShowAdd(false); setEditAsset(null); };
            const handleSubmit = (e) => {
                e.preventDefault();
                const payload = { name, type, value: type === AssetType.GOLD ? 0 : parseFloat(val || '0'), weight: type === AssetType.GOLD ? parseFloat(weight || '0') : 0 };
                editAsset ? onUpdate(editAsset.id, payload) : onAdd(payload);
                resetForm();
            };
            const startEdit = (a) => { setEditAsset(a); setName(a.name); setType(a.type); setVal(a.value || ''); setWeight(a.weight || ''); setShowAdd(true); };

            return html`
                <div className="view-container animate-slideUp">
                    <header className="flex justify-between items-end py-4 shrink-0 px-1">
                        <div>
                            <h1 className="text-2xl font-black gold-text uppercase tracking-tighter">資產部隊</h1>
                            <p className="text-zinc-500 text-[10px] tracking-widest font-bold">精準控制每一枚籌碼。</p>
                        </div>
                        <button onClick=${() => { resetForm(); setShowAdd(true); }} className="w-12 h-12 gold-gradient rounded-full flex items-center justify-center text-black shadow-lg active:scale-95">
                            <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="3"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                        </button>
                    </header>
                    
                    <div className="flex-1 overflow-y-auto no-scrollbar space-y-2 pb-24 px-1">
                        ${assets.length === 0 ? html`<div className="text-center py-20 text-zinc-800 italic text-sm">暫無資產部署。</div>` : assets.map(a => html`
                            <div key=${a.id} className="p-4 bg-zinc-900/40 gold-border rounded-xl flex justify-between items-center active:bg-zinc-800" onClick=${() => startEdit(a)}>
                                <div className="flex-1 overflow-hidden mr-2">
                                    <span className="text-[8px] bg-zinc-800 px-1.5 py-0.5 rounded text-zinc-400 font-black uppercase mb-1 inline-block">${a.type}</span>
                                    <h3 className="text-[15px] text-white font-medium truncate">${a.name}</h3>
                                </div>
                                <div className="text-right flex items-center gap-4">
                                    <div className="flex flex-col items-end">
                                        <p className="text-lg font-black gold-text">${fmt(a.type === AssetType.GOLD ? (a.weight || 0) * goldPrice : (a.value || 0))}</p>
                                        ${a.type === AssetType.GOLD && html`<p className="text-[10px] text-zinc-500 font-bold">${a.weight}g</p>`}
                                    </div>
                                    <button onClick=${(e) => { e.stopPropagation(); onDelete(a.id); }} className="text-zinc-800 p-1"><svg width="18" height="18" fill="none" stroke="currentColor" strokeWidth="2"><path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6"/></svg></button>
                                </div>
                            </div>
                        `)}
                    </div>

                    ${showAdd && html`
                        <div className="fixed inset-0 z-[100] modal-blur flex items-center justify-center p-4">
                            <form className="bg-zinc-950 gold-border p-6 rounded-[2rem] space-y-5 shadow-2xl w-full max-w-sm" onSubmit=${handleSubmit}>
                                <div className="flex justify-between items-center"><h2 className="text-lg gold-text font-black uppercase tracking-widest">${editAsset ? '修改資產' : '部署新資產'}</h2><button type="button" onClick=${resetForm} className="text-zinc-600 text-3xl">&times;</button></div>
                                <div className="space-y-4">
                                    <input required placeholder="名稱 (例如: 匯豐儲蓄)" value=${name} onChange=${e => setName(e.target.value)} className="w-full bg-zinc-900 border border-zinc-800 p-4 rounded-xl text-white gold-border-focus" />
                                    <div className="grid grid-cols-3 gap-2">${Object.values(AssetType).map(t => html`<button key=${t} type="button" onClick=${() => setType(t)} className=${`py-2 text-[10px] rounded-lg border transition-all ${type === t ? 'gold-gradient text-black font-black' : 'bg-zinc-900 text-zinc-500 border-zinc-800'}`}>${t}</button>`)}</div>
                                    ${type === AssetType.GOLD ? html`<input required type="number" step="0.01" value=${weight} onChange=${e => setWeight(e.target.value)} placeholder="重量 (g)" className="w-full bg-zinc-900 border border-zinc-800 p-4 rounded-xl text-white gold-border-focus text-xl font-black" />` : html`<input required type="number" value=${val} onChange=${e => setVal(e.target.value)} placeholder="金額 (HKD)" className="w-full bg-zinc-900 border border-zinc-800 p-4 rounded-xl text-white gold-border-focus text-xl font-black" />`}
                                </div>
                                <button type="submit" className="w-full py-4 gold-gradient rounded-2xl text-black font-black uppercase tracking-widest shadow-xl">確認執行</button>
                            </form>
                        </div>
                    `}
                </div>
            `;
        };

        const ExpensesView = ({ expenses, onAdd, onDelete }) => {
            const [showAdd, setShowAdd] = useState(false);
            const [amount, setAmount] = useState('');
            const [cat, setCat] = useState(CATEGORIES[0]);
            const [note, setNote] = useState('');

            return html`
                <div className="view-container animate-slideUp">
                    <header className="flex justify-between items-end py-4 shrink-0 px-1">
                        <div>
                            <h1 className="text-2xl font-black gold-text uppercase tracking-tighter">現金流出</h1>
                            <p className="text-zinc-500 text-[10px] tracking-widest font-bold uppercase">克制是成功的基石。</p>
                        </div>
                        <button onClick=${() => setShowAdd(true)} className="w-12 h-12 gold-gradient rounded-full flex items-center justify-center text-black shadow-lg active:scale-95">
                            <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="3"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                        </button>
                    </header>
                    <div className="flex-1 overflow-y-auto no-scrollbar space-y-2 pb-24 px-1">
                        ${expenses.length === 0 ? html`<p className="text-center py-20 text-zinc-800 italic text-sm">無支出記錄。</p>` : expenses.map(e => html`
                            <div key=${e.id} className="p-4 bg-zinc-900/30 gold-border rounded-xl flex justify-between items-center">
                                <div className="flex-1 overflow-hidden mr-2">
                                    <p className="text-white text-[15px] font-medium truncate">${e.note}</p>
                                    <p className="text-zinc-600 text-[9px] uppercase font-black tracking-widest mt-1">${e.date} • ${e.category}</p>
                                </div>
                                <div className="text-right flex items-center gap-4">
                                    <span className="text-white font-black text-lg">-${fmt(e.amount)}</span>
                                    <button onClick=${() => onDelete(e.id)} className="text-zinc-800 p-1"><svg width="18" height="18" fill="none" stroke="currentColor" strokeWidth="2"><path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6"/></svg></button>
                                </div>
                            </div>
                        `)}
                    </div>
                    ${showAdd && html`
                        <div className="fixed inset-0 z-[100] modal-blur flex items-center justify-center p-6">
                            <form className="w-full max-w-sm bg-zinc-950 gold-border p-6 rounded-[2.5rem] space-y-5 shadow-2xl" onSubmit=${(ev) => { 
                                ev.preventDefault(); onAdd({ amount: parseFloat(amount || '0'), category: cat, note: note || '生活支出', date: new Date().toISOString().split('T')[0] }); setShowAdd(false); setAmount(''); setNote(''); 
                            }}>
                                <div className="flex justify-between items-center"><h2 className="text-lg gold-text font-black uppercase tracking-widest">下達支出</h2><button type="button" onClick=${() => setShowAdd(false)} className="text-zinc-700 text-3xl">&times;</button></div>
                                <div className="space-y-4">
                                    <input required type="number" placeholder="金額 (HKD)" value=${amount} onChange=${e => setAmount(e.target.value)} className="w-full bg-zinc-900 border border-zinc-800 p-4 rounded-2xl text-2xl font-black text-white gold-border-focus" />
                                    <div className="grid grid-cols-4 gap-2">${CATEGORIES.map(c => html`<button key=${c} type="button" onClick=${() => setCat(c)} className=${`py-2 text-[10px] rounded-lg border transition-all ${cat === c ? 'gold-gradient text-black font-black' : 'bg-zinc-900 text-zinc-500 border-zinc-800'}`}>${c}</button>`)}</div>
                                    <input placeholder="消費備註" value=${note} onChange=${e => setNote(e.target.value)} className="w-full bg-zinc-900 border border-zinc-800 p-4 rounded-xl text-white gold-border-focus text-sm" />
                                </div>
                                <button type="submit" className="w-full py-4 gold-gradient rounded-2xl text-black font-black uppercase tracking-widest shadow-xl mt-2">確認開銷</button>
                            </form>
                        </div>
                    `}
                </div>
            `;
        };

        const SettingsView = ({ goal, userName, onUpdateGoal, onUpdateName }) => html`
            <div className="view-container animate-slideUp py-4 space-y-8 px-1">
                <header>
                    <h1 className="text-2xl font-black gold-text uppercase tracking-tighter">決策中心</h1>
                    <p className="text-zinc-500 text-[10px] tracking-widest font-bold uppercase">重新定義你的野心。</p>
                </header>
                <div className="flex-1 overflow-y-auto no-scrollbar space-y-8 pb-24">
                    <div className="space-y-3">
                        <label className="text-[11px] gold-text font-black uppercase tracking-[0.2em] ml-1">主理人尊稱</label>
                        <input type="text" value=${userName} onChange=${e => onUpdateName(e.target.value)} className="w-full bg-zinc-900/50 gold-border p-5 rounded-2xl text-xl text-white font-bold gold-border-focus" />
                    </div>
                    <div className="space-y-3">
                        <label className="text-[11px] gold-text font-black uppercase tracking-[0.2em] ml-1">年度資產目標 (HKD)</label>
                        <input type="number" value=${goal} onChange=${e => onUpdateGoal(parseFloat(e.target.value) || 0)} className="w-full bg-zinc-900/50 gold-border p-5 rounded-2xl text-3xl font-black text-white gold-border-focus" />
                    </div>
                    <div className="p-6 bg-zinc-900/20 border border-zinc-800 rounded-3xl space-y-4">
                        <h4 className="text-zinc-600 font-black text-[10px] uppercase tracking-[0.3em]">系統核心</h4>
                        <div className="flex justify-between text-[11px] font-mono"><span className="text-zinc-600">VERSION</span><span className="text-zinc-300">v14.2 ELITE</span></div>
                        <div className="flex justify-between text-[11px] font-mono"><span className="text-zinc-600">STORAGE</span><span className="gold-text font-bold uppercase">LocalStorage</span></div>
                    </div>
                </div>
            </div>
        `;

        // --- Main App Logic ---

        const App = () => {
            const [view, setView] = useState('home');
            const [data, setData] = useState(() => {
                const saved = localStorage.getItem('ceo_v14_final');
                return saved ? JSON.parse(saved) : { assets: [], expenses: [], annualGoal: 1000000, userName: '主理人' };
            });
            const [quote, setQuote] = useState(CEO_QUOTES[0]);
            const [goldPrice, setGoldPrice] = useState(695);
            const [isGoldLoading, setIsGoldLoading] = useState(false);

            useEffect(() => { localStorage.setItem('ceo_v14_final', JSON.stringify(data)); }, [data]);
            useEffect(() => { if (view === 'home') setQuote(CEO_QUOTES[Math.floor(Math.random() * CEO_QUOTES.length)]); }, [view]);
            
            const fetchGold = useCallback(async () => {
                setIsGoldLoading(true);
                try {
                    const res = await fetch('https://api.gold-api.com/price/XAU');
                    const json = await res.json();
                    if (json && json.price) {
                        const pricePerGramHKD = (json.price / 31.1034768) * 7.8;
                        setGoldPrice(pricePerGramHKD);
                    }
                } catch (e) { console.warn("Gold sync error"); } finally { setIsGoldLoading(false); }
            }, []);

            useEffect(() => { fetchGold(); const timer = setInterval(fetchGold, 300000); return () => clearInterval(timer); }, [fetchGold]);

            const totalAssets = useMemo(() => data.assets.reduce((s, a) => s + (a.type === AssetType.GOLD ? (a.weight || 0) * goldPrice : (a.value || 0)), 0), [data.assets, goldPrice]);
            const currentMonth = new Date().toISOString().slice(0, 7);
            const totalMonthlyExpenses = useMemo(() => data.expenses.filter(e => e.date.startsWith(currentMonth)).reduce((s, e) => s + (e.amount || 0), 0), [data.expenses, currentMonth]);

            return html`
                <div className="h-screen h-dvh flex flex-col bg-black max-w-md mx-auto relative overflow-hidden safe-top safe-bottom">
                    <main className="flex-1 relative overflow-hidden px-4 flex flex-col">
                        ${view === 'home' && html`<${Home} quote=${quote} totalAssets=${totalAssets} totalMonthlyExpenses=${totalMonthlyExpenses} goal=${data.annualGoal} userName=${data.userName} goldPrice=${goldPrice} isGoldLoading=${isGoldLoading} onRefreshGold=${fetchGold} />`}
                        ${view === 'assets' && html`<${AssetsView} assets=${data.assets} goldPrice=${goldPrice} onAdd=${(a) => setData(d => ({...d, assets: [...d.assets, {...a, id: Date.now().toString()}]}))} onUpdate=${(id, u) => setData(d => ({...d, assets: d.assets.map(a => a.id === id ? {...a, ...u} : a)}))} onDelete=${(id) => setData(d => ({...d, assets: d.assets.filter(a => a.id !== id)}))} />`}
                        ${view === 'expenses' && html`<${ExpensesView} expenses=${data.expenses} onAdd=${(e) => setData(d => ({...d, expenses: [{...e, id: Date.now().toString()}, ...d.expenses]}))} onDelete=${(id) => setData(d => ({...d, expenses: d.expenses.filter(e => e.id !== id)}))} />`}
                        ${view === 'settings' && html`<${SettingsView} goal=${data.annualGoal} userName=${data.userName} onUpdateGoal=${(g) => setData(d => ({...d, annualGoal: g}))} onUpdateName=${(n) => setData(d => ({...d, userName: n}))} />`}
                    </main>

                    <nav className="h-20 shrink-0 bg-zinc-950/90 border-t border-zinc-900 flex justify-around items-center safe-bottom px-4 backdrop-blur-md">
                        ${[
                            { id: 'home', label: '總覽', icon: html`<path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/>` },
                            { id: 'assets', label: '部隊', icon: html`<path d="M12 1v22M17 5H9a4 4 0 000 8h5a4 4 0 010 8H6"/>` },
                            { id: 'expenses', label: '支出', icon: html`<rect width="14" height="18" x="5" y="3" rx="2"/>` },
                            { id: 'settings', label: '決策', icon: html`<circle cx="12" cy="12" r="3"/><path d="M12 2v2M12 20v2M2 12h2M20 12h2"/>` }
                        ].map(item => html`
                            <button key=${item.id} onClick=${() => setView(item.id)} className=${`flex flex-col items-center gap-1.5 transition-all ${view === item.id ? 'gold-text scale-110' : 'text-zinc-700'}`}>
                                <svg width="22" height="22" fill="none" stroke="currentColor" strokeWidth="2.5">${item.icon}</svg>
                                <span className="text-[9px] font-black uppercase tracking-widest">${item.label}</span>
                            </button>
                        `)}
                    </nav>
                </div>
            `;
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(App));
    </script>
</body>
</html>
