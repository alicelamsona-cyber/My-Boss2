<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>CEO Financial Master - 黑金極致</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;700&display=swap" rel="stylesheet">
    <!-- 使用穩定且帶有 crossorigin 的 CDN -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js" crossorigin></script>
    <style>
        :root { --gold: #d4af37; --gold-light: #f9d423; --gold-dark: #aa8b2e; }
        * { -webkit-tap-highlight-color: transparent; touch-action: manipulation; }
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #000;
            color: #e5e5e5;
            height: 100vh;
            height: 100dvh;
            margin: 0;
            overflow: hidden;
        }
        .gold-gradient { background: linear-gradient(135deg, var(--gold) 0%, var(--gold-light) 50%, var(--gold-dark) 100%); }
        .gold-text {
            background: linear-gradient(135deg, var(--gold) 0%, var(--gold-light) 50%, var(--gold-dark) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .gold-border { border: 1px solid rgba(212, 175, 55, 0.3); }
        .gold-border-focus:focus { border-color: var(--gold); outline: none; box-shadow: 0 0 10px rgba(212, 175, 55, 0.2); }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .safe-bottom { padding-bottom: env(safe-area-inset-bottom); }
        .safe-top { padding-top: env(safe-area-inset-top); }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .animate-slideUp { animation: slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        .modal-blur { backdrop-filter: blur(20px); background-color: rgba(0,0,0,0.85); }
        input[type="date"]::-webkit-calendar-picker-indicator { filter: invert(1); }
        
        /* 手機端彈窗內容優化 */
        .modal-content { 
            max-height: 80vh; 
            overflow-y: auto; 
            -webkit-overflow-scrolling: touch;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        const AssetType = { CASH: '現金', STOCKS: '股票', US_BONDS: '美債', GOLD: '黃金', SAVINGS: '定期', OTHERS: '其他' };
        const CATEGORIES = ['餐飲', '交通', '娛樂', '購物', '居住', '醫療', '教育', '其他'];
        const CEO_QUOTES = [
            "這點錢也想退休？我看你是想在大街上退休。",
            "我的字典裡沒有『窮』這個字，希望你的帳本裡也沒有。",
            "這筆開銷... 你是覺得我給你的卡刷不爆嗎？",
            "認真點，你的資產增長速度還不如我喝咖啡的速度。",
            "如果你連自己的錢都管不好，你拿什麼管我的心？",
            "跟我在一起，你的野心應該比你的餘額更大。",
            "省下那杯拿鐵，你也不會變富有；但我喜歡你為了目標克制的樣子。",
            "這張報表，我不滿意。明天我要看到成長。",
            "錢不是省出來的，是賺出來的。但如果你連省都不會，你拿什麼去賺？"
        ];

        const fmt = (v) => new Intl.NumberFormat('zh-HK', { style: 'currency', currency: 'HKD', maximumFractionDigits: 0 }).format(v);

        // --- 子組件 ---

        const Home = ({ quote, totalAssets, totalAnnualExpenses, goal, userName, goldPrice }) => {
            const percentage = Math.min(Math.round((totalAssets / goal) * 100), 100);
            return (
                <div className="flex flex-col h-full justify-between pb-8 animate-slideUp">
                    <div className="space-y-6">
                        <div className="relative p-6 gold-border bg-zinc-900/40 rounded-2xl mt-4">
                            <div className="absolute -top-3 left-6 bg-black px-2 gold-text font-bold text-xs tracking-widest uppercase">{userName} 的指示</div>
                            <p className="text-xl font-light italic text-white leading-relaxed">「{quote}」</p>
                            <div className="mt-2 text-right"><span className="gold-text font-bold text-xs">— {userName}</span></div>
                        </div>

                        <div className="flex flex-col items-center py-4">
                            <div className="relative w-48 h-48 flex items-center justify-center">
                                <svg className="absolute w-full h-full -rotate-90" viewBox="0 0 200 200">
                                    <circle cx="100" cy="100" r="85" stroke="rgba(212, 175, 55, 0.1)" strokeWidth="10" fill="transparent" />
                                    <circle cx="100" cy="100" r="85" stroke="#d4af37" strokeWidth="10" fill="transparent" strokeDasharray="534" strokeDashoffset={534 - (534 * percentage) / 100} strokeLinecap="round" className="transition-all duration-1000" />
                                </svg>
                                <div className="text-center z-10">
                                    <span className="text-5xl font-black gold-text">{percentage}%</span>
                                    <p className="text-gray-500 text-xs mt-1 uppercase tracking-widest">Goal Status</p>
                                </div>
                            </div>
                            <div className="text-center mt-6">
                                <p className="text-3xl font-light text-white tracking-tight">{fmt(totalAssets)}</p>
                                <p className="text-gray-500 text-[10px] uppercase font-bold tracking-widest mt-1">年度目標：{fmt(goal)}</p>
                            </div>
                        </div>
                    </div>

                    <div className="grid grid-cols-2 gap-4 mb-4">
                        <div className="p-5 bg-zinc-900/50 rounded-2xl gold-border">
                            <p className="text-gray-500 text-[9px] uppercase font-bold tracking-widest mb-1">今年累計支出</p>
                            <p className="text-lg font-bold text-white">{fmt(totalAnnualExpenses)}</p>
                        </div>
                        <div className="p-5 bg-zinc-900/50 rounded-2xl gold-border">
                            <p className="text-gray-500 text-[9px] uppercase font-bold tracking-widest mb-1">實時金價/g</p>
                            <p className="text-lg font-bold gold-text">HKD {goldPrice.toFixed(1)}</p>
                        </div>
                    </div>
                </div>
            );
        };

        const Assets = ({ assets, onAdd, onUpdate, onDelete, goldPrice }) => {
            const [showAdd, setShowAdd] = useState(false);
            const [editAsset, setEditAsset] = useState(null);
            
            const [name, setName] = useState('');
            const [val, setVal] = useState('');
            const [weight, setWeight] = useState('');
            const [type, setType] = useState(AssetType.CASH);
            const [rate, setRate] = useState('');
            const [maturity, setMaturity] = useState('');

            const resetForm = () => { setName(''); setVal(''); setWeight(''); setRate(''); setMaturity(''); setType(AssetType.CASH); setShowAdd(false); setEditAsset(null); };

            const handleStartEdit = (a) => {
                setEditAsset(a);
                setName(a.name);
                setType(a.type);
                setVal(a.value || '');
                setWeight(a.weight || '');
                setRate(a.interestRate || '');
                setMaturity(a.maturityDate || '');
            };

            return (
                <div className="flex flex-col h-full animate-slideUp">
                    <div className="flex justify-between items-end mb-8 pt-6 shrink-0">
                        <div>
                            <h1 className="text-3xl font-black gold-text uppercase tracking-tighter">資產部隊</h1>
                            <p className="text-gray-500 text-xs tracking-widest mt-1">掌握每一份金錢的動向。</p>
                        </div>
                        <button onClick={() => setShowAdd(true)} className="w-14 h-14 gold-gradient rounded-full flex items-center justify-center text-black shadow-xl">
                            <svg width="28" height="28" fill="none" stroke="currentColor" strokeWidth="3"><line x1="14" y1="6" x2="14" y2="22"/><line x1="6" y1="14" x2="22" y2="14"/></svg>
                        </button>
                    </div>
                    
                    <div className="flex-1 overflow-y-auto no-scrollbar space-y-4 pb-24">
                        {assets.length === 0 ? <div className="text-center py-20 text-gray-700 italic">資產庫目前為空。</div> : assets.map(a => (
                            <div key={a.id} className="p-6 bg-zinc-900/40 gold-border rounded-2xl flex justify-between items-center" onClick={() => handleStartEdit(a)}>
                                <div className="flex-1 overflow-hidden mr-4">
                                    <p className="text-gray-500 text-[10px] font-bold uppercase tracking-widest mb-1">{a.type}</p>
                                    <h3 className="text-xl text-white font-medium truncate">{a.name}</h3>
                                    <div className="flex gap-4 text-[10px] text-gray-600 font-mono mt-1 tracking-tight">
                                        {a.type === AssetType.GOLD && <span>{a.weight}g</span>}
                                        {a.interestRate && <span>{a.interestRate}%</span>}
                                        {a.maturityDate && <span>到期: {a.maturityDate}</span>}
                                    </div>
                                </div>
                                <div className="text-right flex items-center gap-4">
                                    <p className="text-xl font-bold gold-text whitespace-nowrap">{fmt(a.type === AssetType.GOLD ? a.weight * goldPrice : a.value)}</p>
                                    <button onClick={(e) => { e.stopPropagation(); onDelete(a.id); }} className="text-zinc-800 hover:text-red-500 transition-colors p-1">
                                        <svg width="20" height="20" fill="none" stroke="currentColor" strokeWidth="2"><path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6"/></svg>
                                    </button>
                                </div>
                            </div>
                        ))}
                    </div>

                    {(showAdd || editAsset) && (
                        <div className="fixed inset-0 z-[100] modal-blur flex items-center justify-center p-4">
                            <form className="w-full max-w-sm bg-zinc-950 gold-border p-6 rounded-[2rem] space-y-5 animate-slideUp shadow-2xl modal-content" onSubmit={e => {
                                e.preventDefault();
                                const payload = { 
                                    name, type, 
                                    value: type === AssetType.GOLD ? 0 : parseFloat(val || 0), 
                                    weight: type === AssetType.GOLD ? parseFloat(weight || 0) : undefined, 
                                    interestRate: (type === AssetType.US_BONDS || type === AssetType.SAVINGS) ? parseFloat(rate || 0) : undefined, 
                                    maturityDate: (type === AssetType.US_BONDS || type === AssetType.SAVINGS) ? maturity : undefined 
                                };
                                editAsset ? onUpdate(editAsset.id, payload) : onAdd(payload);
                                resetForm();
                            }}>
                                <div className="flex justify-between items-center">
                                    <h2 className="text-xl gold-text font-black uppercase tracking-widest">{editAsset ? '修改部隊' : '新增資產'}</h2>
                                    <button type="button" onClick={resetForm} className="text-zinc-700 text-3xl leading-none">&times;</button>
                                </div>
                                <div className="space-y-4">
                                    <input required placeholder="資產名稱" value={name} onChange={e => setName(e.target.value)} className="w-full bg-zinc-900 border border-zinc-800 p-3 rounded-xl text-white gold-border-focus text-lg" />
                                    
                                    <div className="grid grid-cols-3 gap-2">
                                        {Object.values(AssetType).map(t => <button key={t} type="button" onClick={() => setType(t)} className={`py-2 text-[10px] rounded-lg border transition-all ${type === t ? 'gold-gradient text-black font-black' : 'bg-zinc-900 text-zinc-600 border-zinc-800'}`}>{t}</button>)}
                                    </div>

                                    {type === AssetType.GOLD ? (
                                        <div className="space-y-1">
                                            <input required type="number" step="0.01" value={weight} onChange={e => setWeight(e.target.value)} placeholder="重量 (g)" className="w-full bg-zinc-900 border border-zinc-800 p-3 rounded-xl text-white gold-border-focus text-xl" />
                                            <p className="text-[11px] text-zinc-500 italic px-1">實時估值: {fmt(parseFloat(weight || 0) * goldPrice)}</p>
                                        </div>
                                    ) : (
                                        <input required type="number" value={val} onChange={e => setVal(e.target.value)} placeholder="金額 (HKD)" className="w-full bg-zinc-900 border border-zinc-800 p-4 rounded-xl text-2xl font-bold text-white gold-border-focus" />
                                    )}

                                    {(type === AssetType.US_BONDS || type === AssetType.SAVINGS) && (
                                        <div className="grid grid-cols-2 gap-3">
                                            <div>
                                                <label className="text-[9px] text-zinc-500 uppercase block mb-1 ml-1">利率 %</label>
                                                <input placeholder="4.5" type="number" step="0.01" value={rate} onChange={e => setRate(e.target.value)} className="w-full bg-zinc-900 border border-zinc-800 p-3 rounded-xl text-white gold-border-focus" />
                                            </div>
                                            <div>
                                                <label className="text-[9px] text-zinc-500 uppercase block mb-1 ml-1">到期日</label>
                                                <input type="date" value={maturity} onChange={e => setMaturity(e.target.value)} className="w-full bg-zinc-900 border border-zinc-800 p-3 rounded-xl text-white text-xs gold-border-focus" />
                                            </div>
                                        </div>
                                    )}
                                </div>
                                <button type="submit" className="w-full py-4 gold-gradient rounded-xl text-black font-black uppercase tracking-[0.2em] shadow-2xl transition-transform active:scale-95">確認部署</button>
                            </form>
                        </div>
                    )}
                </div>
            );
        };

        const Expenses = ({ expenses, onAdd, onDelete }) => {
            const [showAdd, setShowAdd] = useState(false);
            const [amount, setAmount] = useState('');
            const [cat, setCat] = useState(CATEGORIES[0]);
            const [note, setNote] = useState('');

            return (
                <div className="flex flex-col h-full animate-slideUp">
                    <div className="flex justify-between items-end mb-8 pt-6 shrink-0">
                        <div>
                            <h1 className="text-3xl font-black gold-text uppercase tracking-tighter">日常供養</h1>
                            <p className="text-gray-500 text-xs tracking-widest mt-1">每一筆開銷都應有其價值。</p>
                        </div>
                        <button onClick={() => setShowAdd(true)} className="w-14 h-14 gold-gradient rounded-full flex items-center justify-center text-black shadow-xl">
                            <svg width="28" height="28" fill="none" stroke="currentColor" strokeWidth="3"><line x1="14" y1="6" x2="14" y2="22"/><line x1="6" y1="14" x2="22" y2="14"/></svg>
                        </button>
                    </div>
                    <div className="flex-1 overflow-y-auto no-scrollbar space-y-4 pb-24">
                        {expenses.length === 0 ? <p className="text-center py-20 text-zinc-800 italic">尚無任何賞賜記錄。</p> : expenses.map(e => (
                            <div key={e.id} className="p-6 bg-zinc-900/30 gold-border rounded-2xl flex justify-between items-center">
                                <div className="flex-1 overflow-hidden mr-4">
                                    <div className="flex items-center gap-4">
                                        <div className="w-10 h-10 bg-zinc-800 rounded-lg flex-shrink-0 flex items-center justify-center text-[10px] text-zinc-500 font-bold uppercase">{e.category.slice(0,2)}</div>
                                        <div className="overflow-hidden">
                                            <p className="text-white text-lg font-medium truncate">{e.note}</p>
                                            <p className="text-zinc-600 text-[10px] tracking-widest uppercase mt-1">{e.date} • {e.category}</p>
                                        </div>
                                    </div>
                                </div>
                                <div className="text-right flex items-center gap-4 whitespace-nowrap">
                                    <span className="text-white font-bold text-xl">-{fmt(e.amount)}</span>
                                    <button onClick={() => onDelete(e.id)} className="text-zinc-800 hover:text-red-500 p-1">
                                        <svg width="20" height="20" fill="none" stroke="currentColor" strokeWidth="2"><path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6"/></svg>
                                    </button>
                                </div>
                            </div>
                        ))}
                    </div>
                    {showAdd && (
                        <div className="fixed inset-0 z-[100] modal-blur flex items-center justify-center p-6">
                            <form className="w-full max-w-sm bg-zinc-950 gold-border p-8 rounded-[2.5rem] space-y-8 shadow-2xl modal-content" onSubmit={e => { 
                                e.preventDefault(); onAdd({ amount: parseFloat(amount || 0), category: cat, note: note || '生活所需', date: new Date().toISOString().split('T')[0] }); setShowAdd(false); setAmount(''); setNote(''); 
                            }}>
                                <div className="flex justify-between items-center"><h2 className="text-2xl gold-text font-black uppercase tracking-widest">新增支出</h2><button type="button" onClick={() => setShowAdd(false)} className="text-zinc-700 text-4xl leading-none">&times;</button></div>
                                <div className="space-y-6">
                                    <input required type="number" placeholder="金額 (HKD)" value={amount} onChange={e => setAmount(e.target.value)} className="w-full bg-zinc-900 border border-zinc-800 p-5 rounded-xl text-2xl font-bold text-white gold-border-focus" />
                                    <div className="grid grid-cols-4 gap-2">{CATEGORIES.map(c => <button key={c} type="button" onClick={() => setCat(c)} className={`py-3 text-[10px] rounded-xl border transition-all ${cat === c ? 'gold-gradient text-black font-black' : 'bg-zinc-900 text-zinc-600 border-zinc-800'}`}>{c}</button>)}</div>
                                    <input placeholder="備註" value={note} onChange={e => setNote(e.target.value)} className="w-full bg-zinc-900 border border-zinc-800 p-4 rounded-xl text-white gold-border-focus text-lg" />
                                </div>
                                <button type="submit" className="w-full py-5 gold-gradient rounded-2xl text-black font-black uppercase tracking-[0.2em] shadow-2xl">確認記錄</button>
                            </form>
                        </div>
                    )}
                </div>
            );
        };

        const Settings = ({ goal, userName, onUpdateGoal, onUpdateName }) => (
            <div className="flex flex-col h-full animate-slideUp py-8 space-y-10">
                <div>
                    <h1 className="text-3xl font-black gold-text uppercase tracking-tighter">決策中心</h1>
                    <p className="text-gray-500 text-xs tracking-widest mt-1">在這裡重新定義你的野心。</p>
                </div>
                <div className="flex-1 overflow-y-auto space-y-10 no-scrollbar pb-24">
                    <div className="space-y-3">
                        <label className="text-xs gold-text font-black uppercase tracking-widest ml-1">主理人尊稱</label>
                        <input type="text" value={userName} onChange={e => onUpdateName(e.target.value)} className="w-full bg-zinc-900/50 gold-border p-5 rounded-2xl text-xl text-white gold-border-focus" />
                    </div>
                    <div className="space-y-3">
                        <label className="text-xs gold-text font-black uppercase tracking-widest ml-1">年度總目標 (HKD)</label>
                        <input type="number" value={goal} onChange={e => onUpdateGoal(parseFloat(e.target.value) || 0)} className="w-full bg-zinc-900/50 gold-border p-5 rounded-2xl text-3xl font-black text-white gold-border-focus" />
                    </div>
                    <div className="p-8 bg-zinc-900/20 border border-zinc-800 rounded-3xl space-y-5">
                        <h4 className="text-zinc-600 font-bold text-[10px] uppercase tracking-widest">系統數據中心</h4>
                        <div className="flex justify-between text-xs font-mono"><span className="text-zinc-600 uppercase">Version</span><span className="text-zinc-300">v11.2 Stable</span></div>
                        <div className="flex justify-between text-xs font-mono"><span className="text-zinc-600 uppercase">Data State</span><span className="gold-text">ENCRYPTED-LOCAL</span></div>
                    </div>
                </div>
            </div>
        );

        // --- 主應用 ---

        const App = () => {
            const [view, setView] = useState('home');
            const [data, setData] = useState(() => {
                try {
                    const saved = localStorage.getItem('ceo_v11_data');
                    return saved ? JSON.parse(saved) : { assets: [], expenses: [], annualGoal: 1000000, userName: '顧北辰' };
                } catch (e) {
                    return { assets: [], expenses: [], annualGoal: 1000000, userName: '顧北辰' };
                }
            });
            const [quote, setQuote] = useState(CEO_QUOTES[0]);
            const [goldPrice, setGoldPrice] = useState(685.2);

            useEffect(() => { 
                try {
                    localStorage.setItem('ceo_v11_data', JSON.stringify(data)); 
                } catch (e) { console.warn("Storage write failed"); }
            }, [data]);
            
            useEffect(() => { if (view === 'home') setQuote(CEO_QUOTES[Math.floor(Math.random() * CEO_QUOTES.length)]); }, [view]);
            
            useEffect(() => { 
                const fetchGold = async () => {
                    try {
                        const res = await fetch('https://api.gold-api.com/price/XAU');
                        const json = await res.json();
                        if (json && json.price) {
                            const pricePerGramHKD = (json.price / 31.1035) * 7.82;
                            setGoldPrice(pricePerGramHKD);
                        }
                    } catch (e) { console.warn("Gold API sync failed"); }
                };
                fetchGold();
                const timer = setInterval(fetchGold, 300000);
                return () => clearInterval(timer);
            }, []);

            const totalAssets = useMemo(() => data.assets.reduce((s, a) => s + (a.type === AssetType.GOLD ? a.weight * goldPrice : a.value), 0), [data.assets, goldPrice]);
            const totalAnnualExpenses = useMemo(() => data.expenses.filter(e => e.date.startsWith(new Date().getFullYear().toString())).reduce((s, e) => s + e.amount, 0), [data.expenses]);

            return (
                <div className="h-screen h-dvh flex flex-col bg-black relative max-w-md mx-auto border-x border-zinc-900 shadow-2xl overflow-hidden safe-top safe-bottom">
                    <main className="flex-1 overflow-hidden px-6 pt-4">
                        {view === 'home' && <Home quote={quote} totalAssets={totalAssets} totalAnnualExpenses={totalAnnualExpenses} goal={data.annualGoal} userName={data.userName} goldPrice={goldPrice} />}
                        {view === 'assets' && <Assets assets={data.assets} goldPrice={goldPrice} onAdd={a => setData(d => ({...d, assets: [...d.assets, {...a, id: Date.now().toString()}]}))} onUpdate={(id, u) => setData(d => ({...d, assets: d.assets.map(a => a.id === id ? {...a, ...u} : a)}))} onDelete={id => setData(d => ({...d, assets: d.assets.filter(a => a.id !== id)}))} />}
                        {view === 'expenses' && <Expenses expenses={data.expenses} onAdd={e => setData(d => ({...d, expenses: [{...e, id: Date.now().toString()}, ...d.expenses]}))} onDelete={id => setData(d => ({...d, expenses: d.expenses.filter(e => e.id !== id)}))} />}
                        {view === 'settings' && <Settings goal={data.annualGoal} userName={data.userName} onUpdateGoal={g => setData(d => ({...d, annualGoal: g}))} onUpdateName={n => setData(d => ({...d, userName: n}))} />}
                    </main>

                    <nav className="h-24 shrink-0 bg-zinc-950/95 border-t border-zinc-900 flex justify-around items-center safe-bottom">
                        {[
                            { id: 'home', label: '總覽', icon: <path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/> },
                            { id: 'assets', label: '部隊', icon: <path d="M12 1v22M17 5H9a4 4 0 000 8h5a4 4 0 010 8H6"/> },
                            { id: 'expenses', label: '賞賜', icon: <rect width="14" height="18" x="5" y="3" rx="2"/> },
                            { id: 'settings', label: '中心', icon: <g><circle cx="12" cy="12" r="3"/><path d="M12 2v2M12 20v2M2 12h2M20 12h2"/></g> }
                        ].map(item => (
                            <button key={item.id} onClick={() => setView(item.id)} className={`flex flex-col items-center gap-2 transition-all duration-300 ${view === item.id ? 'gold-text scale-110' : 'text-zinc-700'}`}>
                                <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2.5">{item.icon}</svg>
                                <span className="text-[10px] font-black uppercase tracking-[0.2em]">{item.label}</span>
                            </button>
                        ))}
                    </nav>
                </div>
            );
        };

        // 確保 DOM 加載完畢後掛載
        const init = () => {
            const container = document.getElementById('root');
            if (container) {
                const root = ReactDOM.createRoot(container);
                root.render(<App />);
            }
        };

        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    </script>
</body>
</html>import React, { useState, useEffect, useMemo } from 'react';
import { createRoot } from 'react-dom/client';

const AssetType = { CASH: '現金', STOCKS: '股票', US_BONDS: '美債', GOLD: '黃金', SAVINGS: '定期', OTHERS: '其他' };
const CATEGORIES = ['餐飲', '交通', '娛樂', '購物', '居住', '醫療', '教育', '其他'];
const CEO_QUOTES = [
    "這點錢也想退休？我看你是想在大街上退休。",
    "我的字典裡沒有『窮』這個字，希望你的帳本裡也沒有。",
    "這筆開銷... 你是覺得我給你的卡刷不爆嗎？",
    "認真點，你的資產增長速度還不如我喝咖啡的速度。",
    "如果你連自己的錢都管不好，你拿什麼管我的心？",
    "跟我在一起，你的野心應該比你的餘額更大。",
    "省下那杯拿鐵，你也不會變富有；但我喜歡你為了目標克制的樣子。",
    "這張報表，我不滿意。明天我要看到成長。",
    "錢不是省出來的，是賺出來的。但如果你連省都不會，你拿什麼去賺？"
];

const fmt = (v: number) => new Intl.NumberFormat('zh-HK', { style: 'currency', currency: 'HKD', maximumFractionDigits: 0 }).format(v);

// --- 子組件 ---

const Home = ({ quote, totalAssets, totalAnnualExpenses, goal, userName, goldPrice }: any) => {
    const percentage = Math.min(Math.round((totalAssets / goal) * 100), 100);
    return (
        <div className="flex flex-col h-full justify-between pb-8 animate-slideUp">
            <div className="space-y-6">
                <div className="relative p-6 gold-border bg-zinc-900/40 rounded-2xl mt-6">
                    <div className="absolute -top-3 left-6 bg-black px-2 gold-text font-bold text-xs tracking-widest uppercase">{userName} 的指示</div>
                    <p className="text-xl font-light italic text-white leading-relaxed">「{quote}」</p>
                    <div className="mt-2 text-right"><span className="gold-text font-bold text-xs">— {userName}</span></div>
                </div>

                <div className="flex flex-col items-center py-6">
                    <div className="relative w-48 h-48 flex items-center justify-center">
                        <svg className="absolute w-full h-full -rotate-90">
                            <circle cx="50%" cy="50%" r="85" stroke="rgba(212, 175, 55, 0.1)" strokeWidth="10" fill="transparent" />
                            <circle cx="50%" cy="50%" r="85" stroke="#d4af37" strokeWidth="10" fill="transparent" strokeDasharray="534" strokeDashoffset={534 - (534 * percentage) / 100} strokeLinecap="round" className="transition-all duration-1000" />
                        </svg>
                        <div className="text-center z-10">
                            <span className="text-5xl font-black gold-text">{percentage}%</span>
                            <p className="text-gray-500 text-xs mt-1 uppercase tracking-widest">Goal</p>
                        </div>
                    </div>
                    <div className="text-center mt-6">
                        <p className="text-3xl font-light text-white tracking-tight">{fmt(totalAssets)}</p>
                        <p className="text-gray-500 text-[10px] uppercase font-bold tracking-widest mt-1">年度目標：{fmt(goal)}</p>
                    </div>
                </div>
            </div>

            <div className="grid grid-cols-2 gap-4 mb-4">
                <div className="p-5 bg-zinc-900/50 rounded-2xl gold-border">
                    <p className="text-gray-500 text-[9px] uppercase font-bold tracking-widest mb-1">今年累計支出</p>
                    <p className="text-lg font-bold text-white">{fmt(totalAnnualExpenses)}</p>
                </div>
                <div className="p-5 bg-zinc-900/50 rounded-2xl gold-border">
                    <p className="text-gray-500 text-[9px] uppercase font-bold tracking-widest mb-1">實時金價/g</p>
                    <p className="text-lg font-bold gold-text">HKD {goldPrice.toFixed(1)}</p>
                </div>
            </div>
        </div>
    );
};

const Assets = ({ assets, onAdd, onUpdate, onDelete, goldPrice }: any) => {
    const [showAdd, setShowAdd] = useState(false);
    const [editAsset, setEditAsset] = useState<any>(null);
    
    const [name, setName] = useState('');
    const [val, setVal] = useState('');
    const [weight, setWeight] = useState('');
    const [type, setType] = useState(AssetType.CASH);
    const [rate, setRate] = useState('');
    const [maturity, setMaturity] = useState('');

    const resetForm = () => { setName(''); setVal(''); setWeight(''); setRate(''); setMaturity(''); setType(AssetType.CASH); setShowAdd(false); setEditAsset(null); };

    const handleStartEdit = (a: any) => {
        setEditAsset(a);
        setName(a.name);
        setType(a.type);
        setVal(a.value || '');
        setWeight(a.weight || '');
        setRate(a.interestRate || '');
        setMaturity(a.maturityDate || '');
    };

    return (
        <div className="flex flex-col h-full animate-slideUp">
            <div className="flex justify-between items-end mb-8 pt-6 shrink-0">
                <div>
                    <h1 className="text-3xl font-black gold-text uppercase tracking-tighter">我的軍隊</h1>
                    <p className="text-gray-500 text-xs tracking-widest mt-1">掌控每一份資產的動向。</p>
                </div>
                <button onClick={() => setShowAdd(true)} className="w-14 h-14 gold-gradient rounded-full flex items-center justify-center text-black shadow-xl">
                    <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                </button>
            </div>
            
            <div className="flex-1 overflow-y-auto no-scrollbar space-y-4 pb-24">
                {assets.length === 0 ? <div className="text-center py-20 text-gray-700 italic">目前沒有任何部隊進駐。</div> : assets.map((a: any) => (
                    <div key={a.id} className="p-6 bg-zinc-900/40 gold-border rounded-[1.5rem] flex justify-between items-center hover:bg-zinc-800/40 transition-colors" onClick={() => handleStartEdit(a)}>
                        <div className="flex-1">
                            <p className="text-gray-500 text-[10px] font-bold uppercase tracking-widest mb-1">{a.type}</p>
                            <h3 className="text-xl text-white font-medium truncate w-48">{a.name}</h3>
                            <div className="flex gap-4 text-[10px] text-gray-600 font-mono mt-1 tracking-tight">
                                {a.type === AssetType.GOLD && <span>{a.weight}g</span>}
                                {a.interestRate && <span>利率: {a.interestRate}%</span>}
                                {a.maturityDate && <span>到期: {a.maturityDate}</span>}
                            </div>
                        </div>
                        <div className="text-right flex items-center gap-5">
                            <p className="text-2xl font-bold gold-text">{fmt(a.type === AssetType.GOLD ? a.weight * goldPrice : a.value)}</p>
                            <button onClick={(e) => { e.stopPropagation(); onDelete(a.id); }} className="text-zinc-800 hover:text-red-500 transition-colors">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6M8 6V4a2 2 0 012-2h4a2 2 0 012 2v2"/></svg>
                            </button>
                        </div>
                    </div>
                ))}
            </div>

            {(showAdd || editAsset) && (
                <div className="fixed inset-0 z-[100] modal-blur flex items-center justify-center p-6">
                    <form className="w-full max-w-sm bg-zinc-950 gold-border p-8 rounded-[2.5rem] space-y-8 animate-slideUp shadow-2xl" onSubmit={e => {
                        e.preventDefault();
                        const payload = { 
                            name, type, 
                            value: type === AssetType.GOLD ? 0 : parseFloat(val), 
                            weight: type === AssetType.GOLD ? parseFloat(weight) : undefined, 
                            interestRate: (type === AssetType.US_BONDS || type === AssetType.SAVINGS) ? parseFloat(rate) : undefined, 
                            maturityDate: (type === AssetType.US_BONDS || type === AssetType.SAVINGS) ? maturity : undefined 
                        };
                        editAsset ? onUpdate(editAsset.id, payload) : onAdd(payload);
                        resetForm();
                    }}>
                        <div className="flex justify-between items-center">
                            <h2 className="text-2xl gold-text font-black uppercase tracking-widest">{editAsset ? '調整編制' : '新增部隊'}</h2>
                            <button type="button" onClick={resetForm} className="text-zinc-700 text-4xl leading-none">&times;</button>
                        </div>
                        <div className="space-y-5">
                            <div className="space-y-1">
                                <label className="text-[10px] text-zinc-600 uppercase font-bold tracking-widest ml-1">資產名稱</label>
                                <input required placeholder="例如：恆生定期" value={name} onChange={e => setName(e.target.value)} className="w-full bg-zinc-900 border border-zinc-800 p-4 rounded-xl text-white gold-border-focus text-lg" />
                            </div>
                            <div className="space-y-2">
                                <label className="text-[10px] text-zinc-600 uppercase font-bold tracking-widest ml-1">資產類別</label>
                                <div className="grid grid-cols-3 gap-2">
                                    {(Object.values(AssetType) as string[]).map(t => <button key={t} type="button" onClick={() => setType(t)} className={`py-3 text-[10px] rounded-xl border transition-all ${type === t ? 'gold-gradient text-black font-black border-transparent' : 'bg-zinc-900 text-zinc-600 border-zinc-800'}`}>{t}</button>)}
                                </div>
                            </div>
                            {type === AssetType.GOLD ? (
                                <div className="space-y-1">
                                    <label className="text-[10px] text-zinc-600 uppercase font-bold tracking-widest ml-1">持有重量 (克)</label>
                                    <input required type="number" step="0.01" value={weight} onChange={e => setWeight(e.target.value)} className="w-full bg-zinc-900 border border-zinc-800 p-4 rounded-xl text-white gold-border-focus text-xl" />
                                    <p className="text-[11px] text-zinc-500 italic px-1">當前估值: {fmt(parseFloat(weight || '0') * goldPrice)}</p>
                                </div>
                            ) : (
                                <div className="space-y-1">
                                    <label className="text-[10px] text-zinc-600 uppercase font-bold tracking-widest ml-1">持有金額 (HKD)</label>
                                    <input required type="number" value={val} onChange={e => setVal(e.target.value)} placeholder="0" className="w-full bg-zinc-900 border border-zinc-800 p-5 rounded-xl text-2xl font-bold text-white gold-border-focus" />
                                </div>
                            )}
                            {(type === AssetType.US_BONDS || type === AssetType.SAVINGS) && (
                                <div className="grid grid-cols-2 gap-4 animate-slideUp">
                                    <div className="space-y-1">
                                        <label className="text-[10px] text-zinc-600 uppercase font-bold tracking-widest ml-1">預期利率 %</label>
                                        <input placeholder="4.5" type="number" step="0.01" value={rate} onChange={e => setRate(e.target.value)} className="w-full bg-zinc-900 border border-zinc-800 p-4 rounded-xl text-white gold-border-focus" />
                                    </div>
                                    <div className="space-y-1">
                                        <label className="text-[10px] text-zinc-600 uppercase font-bold tracking-widest ml-1">到期日期</label>
                                        <input type="date" value={maturity} onChange={e => setMaturity(e.target.value)} className="w-full bg-zinc-900 border border-zinc-800 p-4 rounded-xl text-white text-xs gold-border-focus" />
                                    </div>
                                </div>
                            )}
                        </div>
                        <button type="submit" className="w-full py-5 gold-gradient rounded-2xl text-black font-black uppercase tracking-[0.2em] shadow-2xl transition-transform active:scale-95 text-sm">確認部屬</button>
                    </form>
                </div>
            )}
        </div>
    );
};

const Expenses = ({ expenses, onAdd, onDelete }: any) => {
    const [showAdd, setShowAdd] = useState(false);
    const [amount, setAmount] = useState('');
    const [cat, setCat] = useState(CATEGORIES[0]);
    const [note, setNote] = useState('');

    return (
        <div className="flex flex-col h-full animate-slideUp">
            <div className="flex justify-between items-end mb-8 pt-6 shrink-0">
                <div>
                    <h1 className="text-3xl font-black gold-text uppercase tracking-tighter">日常供養</h1>
                    <p className="text-gray-500 text-xs tracking-widest mt-1">每一筆開銷都應有其價值。</p>
                </div>
                <button onClick={() => setShowAdd(true)} className="w-14 h-14 gold-gradient rounded-full flex items-center justify-center text-black shadow-xl">
                    <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><line x1="14" y1="6" x2="14" y2="22"/><line x1="6" y1="14" x2="22" y2="14"/></svg>
                </button>
            </div>
            <div className="flex-1 overflow-y-auto no-scrollbar space-y-4 pb-24">
                {expenses.length === 0 ? <p className="text-center py-20 text-zinc-800 italic">目前沒有任何領賞記錄。</p> : expenses.map((e: any) => (
                    <div key={e.id} className="p-6 bg-zinc-900/30 gold-border rounded-2xl flex justify-between items-center group transition-all hover:bg-zinc-800/20">
                        <div className="flex items-center gap-5">
                            <div className="w-12 h-12 bg-zinc-800 rounded-xl flex items-center justify-center text-xs text-zinc-500 font-black uppercase">{e.category.slice(0,2)}</div>
                            <div><p className="text-white text-lg font-medium">{e.note}</p><p className="text-zinc-600 text-[10px] tracking-[0.15em] uppercase mt-1">{e.date} • {e.category}</p></div>
                        </div>
                        <div className="flex items-center gap-5">
                            <span className="text-white font-bold text-xl">-{fmt(e.amount)}</span>
                            <button onClick={() => onDelete(e.id)} className="text-zinc-800 group-hover:text-red-500 transition-colors">
                                <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6"/></svg>
                            </button>
                        </div>
                    </div>
                ))}
            </div>
            {showAdd && (
                <div className="fixed inset-0 z-[100] modal-blur flex items-center justify-center p-6">
                    <form className="w-full max-w-sm bg-zinc-950 gold-border p-8 rounded-[2.5rem] space-y-8 shadow-2xl" onSubmit={e => { 
                        e.preventDefault(); onAdd({ amount: parseFloat(amount), category: cat, note: note || '生活所需', date: new Date().toISOString().split('T')[0] }); setShowAdd(false); setAmount(''); setNote(''); 
                    }}>
                        <div className="flex justify-between items-center"><h2 className="text-2xl gold-text font-black uppercase tracking-widest">新增支出</h2><button type="button" onClick={() => setShowAdd(false)} className="text-zinc-700 text-4xl leading-none">&times;</button></div>
                        <div className="space-y-6">
                            <div className="space-y-1">
                                <label className="text-[10px] text-zinc-600 uppercase font-bold tracking-widest ml-1">支出金額 (HKD)</label>
                                <input required type="number" placeholder="0" value={amount} onChange={e => setAmount(e.target.value)} className="w-full bg-zinc-900 border border-zinc-800 p-5 rounded-xl text-2xl font-bold text-white gold-border-focus" />
                            </div>
                            <div className="space-y-2">
                                <label className="text-[10px] text-zinc-600 uppercase font-bold tracking-widest ml-1">支出類別</label>
                                <div className="grid grid-cols-4 gap-2">{CATEGORIES.map(c => <button key={c} type="button" onClick={() => setCat(c)} className={`py-3 text-[10px] rounded-xl border transition-all ${cat === c ? 'gold-gradient text-black font-black border-transparent' : 'bg-zinc-900 text-zinc-600 border-zinc-800'}`}>{c}</button>)}</div>
                            </div>
                            <div className="space-y-1">
                                <label className="text-[10px] text-zinc-600 uppercase font-bold tracking-widest ml-1">備註說明</label>
                                <input placeholder="隨手記下..." value={note} onChange={e => setNote(e.target.value)} className="w-full bg-zinc-900 border border-zinc-800 p-4 rounded-xl text-white gold-border-focus text-lg" />
                            </div>
                        </div>
                        <button type="submit" className="w-full py-5 gold-gradient rounded-2xl text-black font-black uppercase tracking-[0.2em] shadow-2xl transition-transform active:scale-95 text-sm">確認記錄</button>
                    </form>
                </div>
            )}
        </div>
    );
};

const Settings = ({ goal, userName, onUpdateGoal, onUpdateName }: any) => (
    <div className="flex flex-col h-full animate-slideUp py-8 space-y-10">
        <div>
            <h1 className="text-3xl font-black gold-text uppercase tracking-tighter">決策中心</h1>
            <p className="text-gray-500 text-xs tracking-widest mt-1">在這裡重新定義你的野心。</p>
        </div>
        <div className="flex-1 overflow-y-auto space-y-10 no-scrollbar pb-24">
            <div className="space-y-3">
                <label className="text-xs gold-text font-black uppercase tracking-widest ml-1">主理人尊稱</label>
                <input type="text" value={userName} onChange={e => onUpdateName(e.target.value)} className="w-full bg-zinc-900/50 gold-border p-5 rounded-2xl text-xl text-white gold-border-focus" />
            </div>
            <div className="space-y-3">
                <label className="text-xs gold-text font-black uppercase tracking-widest ml-1">年度總目標 (HKD)</label>
                <input type="number" value={goal} onChange={e => onUpdateGoal(parseFloat(e.target.value) || 0)} className="w-full bg-zinc-900/50 gold-border p-5 rounded-2xl text-3xl font-black text-white gold-border-focus" />
            </div>
            <div className="p-8 bg-zinc-900/20 border border-zinc-800 rounded-3xl space-y-5">
                <h4 className="text-zinc-600 font-bold text-[10px] uppercase tracking-[0.2em]">系統數據中心</h4>
                <div className="flex justify-between text-xs font-mono"><span className="text-zinc-600 uppercase">Version</span><span className="text-zinc-300">v10.1 Stable</span></div>
                <div className="flex justify-between text-xs font-mono"><span className="text-zinc-600 uppercase">Data Security</span><span className="gold-text">LOCAL-ENCRYPTED</span></div>
                <div className="flex justify-between text-xs font-mono"><span className="text-zinc-600 uppercase">Live Gold API</span><span className="gold-text">ACTIVE</span></div>
            </div>
        </div>
    </div>
);

// --- 主應用 ---

const App = () => {
    const [view, setView] = useState('home');
    const [data, setData] = useState(() => {
        const saved = localStorage.getItem('ceo_v10_data_final');
        return saved ? JSON.parse(saved) : { assets: [], expenses: [], annualGoal: 1000000, userName: '顧北辰' };
    });
    const [quote, setQuote] = useState(CEO_QUOTES[0]);
    const [goldPrice, setGoldPrice] = useState(682.5);

    useEffect(() => { localStorage.setItem('ceo_v10_data_final', JSON.stringify(data)); }, [data]);
    useEffect(() => { if (view === 'home') setQuote(CEO_QUOTES[Math.floor(Math.random() * CEO_QUOTES.length)]); }, [view]);
    
    useEffect(() => { 
        const fetchGold = async () => {
            try {
                const res = await fetch('https://api.gold-api.com/price/XAU');
                const json = await res.json();
                if (json && json.price) {
                    const pricePerGramHKD = (json.price / 31.1035) * 7.82;
                    setGoldPrice(pricePerGramHKD);
                }
            } catch (e) { 
                console.warn("Gold price sync failed");
            }
        };
        fetchGold();
        const timer = setInterval(fetchGold, 300000);
        return () => clearInterval(timer);
    }, []);

    const totalAssets = useMemo(() => data.assets.reduce((s: number, a: any) => s + (a.type === AssetType.GOLD ? (a.weight || 0) * goldPrice : (a.value || 0)), 0), [data.assets, goldPrice]);
    const totalAnnualExpenses = useMemo(() => data.expenses.filter((e: any) => e.date.startsWith(new Date().getFullYear().toString())).reduce((s: number, e: any) => s + e.amount, 0), [data.expenses]);

    return (
        <div className="h-screen h-dvh flex flex-col bg-black relative max-w-md mx-auto border-x border-zinc-900 shadow-2xl overflow-hidden">
            <main className="flex-1 overflow-hidden px-6 pt-4">
                {view === 'home' && <Home quote={quote} totalAssets={totalAssets} totalAnnualExpenses={totalAnnualExpenses} goal={data.annualGoal} userName={data.userName} goldPrice={goldPrice} />}
                {view === 'assets' && <Assets assets={data.assets} goldPrice={goldPrice} onAdd={(a: any) => setData((d: any) => ({...d, assets: [...d.assets, {...a, id: Date.now().toString()}]}))} onUpdate={(id: string, u: any) => setData((d: any) => ({...d, assets: d.assets.map((a: any) => a.id === id ? {...a, ...u} : a)}))} onDelete={(id: string) => setData((d: any) => ({...d, assets: d.assets.filter((a: any) => a.id !== id)}))} />}
                {view === 'expenses' && <Expenses expenses={data.expenses} onAdd={(e: any) => setData((d: any) => ({...d, expenses: [{...e, id: Date.now().toString()}, ...d.expenses]}))} onDelete={(id: string) => setData((d: any) => ({...d, expenses: d.expenses.filter((e: any) => e.id !== id)}))} />}
                {view === 'settings' && <Settings goal={data.annualGoal} userName={data.userName} onUpdateGoal={(g: number) => setData((d: any) => ({...d, annualGoal: g}))} onUpdateName={(n: string) => setData((d: any) => ({...d, userName: n}))} />}
            </main>

            <nav className="h-24 shrink-0 bg-zinc-950/95 border-t border-zinc-900 flex justify-around items-center safe-bottom">
                {[
                    { id: 'home', label: '總覽', icon: <path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/> },
                    { id: 'assets', label: '部隊', icon: <path d="M12 1v22M17 5H9a4 4 0 000 8h5a4 4 0 010 8H6"/> },
                    { id: 'expenses', label: '賞賜', icon: <rect width="14" height="18" x="5" y="3" rx="2"/> },
                    { id: 'settings', label: '中心', icon: <circle cx="12" cy="12" r="3"/><path d="M12 2v2M12 20v2M2 12h2M20 12h2"/> }
                ].map(item => (
                    <button key={item.id} onClick={() => setView(item.id)} className={`flex flex-col items-center gap-2 transition-all duration-300 ${view === item.id ? 'gold-text scale-110' : 'text-zinc-700'}`}>
                        <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2.5">{item.icon}</svg>
                        <span className="text-[10px] font-black uppercase tracking-[0.2em]">{item.label}</span>
                    </button>
                ))}
            </nav>
        </div>
    );
};

const root = createRoot(document.getElementById('root')!);
root.render(<App />);
